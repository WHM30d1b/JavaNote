## 面试题

#### 1. NoSQL 数据库

Not Only SQL：非关系型数据库

关系型数据库**结构化**存储数据，NoSQL 采用**键值对**的方式存储数据。

使用 NoSQL 数据库的情况：

- 处理非结构化 / 半结构化的大数据
- 水平方向上进行扩展
- 随时应对动态增加的数据项时优先考虑使用 NoSQL 数据库
- 数据库的成熟度
- 支持分析和商业智能

管理及专业性等问题时，优先考虑关系型数据库。 



NoSQL 数据库种类：**MongoDB**, Cassandra, CouchDB, Hypertable, **Redis**, Riak, Neo4j, **HBASE**, Couchbase, MemcacheDB, RevenDB and Voldemort



#### 2. MySQL 和 MongoDB 最大差别

关系型和非关系型数据库，数据存储结构不同。



#### 3. MongoDB 优势

- 面向文件
- 高性能
- 高可用
- 易扩展
- 查询语言丰富



#### 4. MongoDB 在 32 位系统上有什么细微差别

**journaling日志功能**：MongoDB先在内存保存写操作，并记录 journaling 日志到磁盘，然后才会刷入到磁盘上的数据文件。能够使 MongoDB 意外故障后快速恢复。默认开启了Journaling日志功能，mongod 实例每次启动时都会检查 journal 日志文件看是否需要恢复。

32 位系统中，journaling 会激活额外的内存映射文件，这进一步抑制了 32 位版本上的数据库大小。因此，journaling 在 32 位系统上默认是禁用的。



#### 5. 分析器的作用

MongoDB 中包括一个显示数据库中每个操作性能特点的数据库分析器。通过分析器找到比预期慢的查询或写操作，利用这一信息确定是否需要添加索引。



#### 6. namespace 是什么

MongoDB 在 collection 中存储 BSON 对象。数据库名字和 collection 名字以句点连结起来叫做命名空间 namespace。

BSON：计算机数据交换格式，被用作 MongoDB 数据库中的数据存储和网络传输格式。它是一种二进制表示形式，能用来表示简单数据结构、关联数组（MongoDB中称为“对象”或“文档”）以及MongoDB中的各种数据类型。BSON之名缘于 JSON，含义为Binary JSON（二进制 JSON ）。



#### 7. 能否添加 null

对象属性可以为 null，但用户不能够添加空值到数据库丛集 ( collection ) 因为空值不是对象，能够添加空对象{}。



#### 8. 更新操作会立刻 fsync 到磁盘吗?

不会，磁盘写操作默认是延迟执行的。写操作默认在 60 秒内后到达磁盘。例如，如果一秒内数据库收到一千个对一个对象递增的操作，仅刷新磁盘一次。



#### 9. MongoDB 不支持事务

MongoDB 设计的宗旨是轻量，快速以及可预计的高性能，没有使用传统的锁或者复杂的带回滚的事务。



#### 10. 为什么数据文件很庞大

MongoDB 预留空间来防止文件系统碎片。



#### 11. Master / Primary 和 Secondary / Slave

主节点是唯一能够接收写请求的节点。MongoDB 在主节点进行写操作，并将这些操作记录到主节点的 oplog 中。从节点会从oplog 复制到其本机，并将这些操作应用到自己的数据集上。



#### 12. getLastError

确认写操作成功提交



#### 13. 是否启用集群分片

开始用非集群分片启动 MongoDB 环境，从非集群分片升级到集群分片是无缝的，所以在数据集还不是很大的时候没必要考虑集群分片。



#### 14. 数据何时迁移到多个分片

MongoDB 分片是基于区域的，一个集合中的所有的对象都被存放到一个块中。只有当存在多余一个块的时候，才会有多个分片获取数据的选项。每个默认块的大小是 64 Mb，所以需要至少 64 Mb 空间才可以实施一个迁移。



#### 15. 试图更新一个正在迁移的块会发生什么？

更新操作会立即发生在旧的分片上，然后更改才会在所有权转移前复制到新的分片上。



#### 16. 在一个分片停止或者很慢的时候，发起一个查询会怎样？

分片停止，返回错误；分片很慢，等待响应。



#### 17. 可以删除 moveChunk 文件夹中内容吗

可以删除。这些文件是在分片进行均衡操作的时候产生的临时文件。一旦这些操作完成，相关的临时文件也应该被删除掉。但目前清理工作需要手动，所以请小心地考虑再释放这些文件的空间。



#### 18. moveChunk 失败后需要手动清除部分转移的文档吗

不需要，moveChunk 是一致(并且是确定性的，失败后会不断重试，完成后数据只会出现在新的分片里。



#### 19. MongoDB 在 A:{B,C}上建立索引，查询 A:{B,C}和 A:{C,B}都会使用索引吗？

只会在 A:{B,C}上使用索引



#### 20. GridFS 机制

GridFS 是一种将大型文件存储在 MongoDB 中的文件规范。

使用 GridFS 可以将大文件分隔成多个小文档存放，能够有效的保存大文档，而且解决了 BSON 对象有限制的问题。





